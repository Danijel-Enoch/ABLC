{"version":3,"file":"index.js","sources":["../src/client.ts","../src/utils.ts"],"sourcesContent":["import type { Chain, Client, Connector } from '@wagmi/core'\nimport {\n  connect,\n  disconnect,\n  fetchBalance,\n  fetchEnsAvatar,\n  fetchEnsName,\n  getAccount,\n  getNetwork,\n  switchNetwork,\n  watchAccount,\n  watchNetwork\n} from '@wagmi/core'\nimport type { ConnectorId } from './types'\n\nexport class EthereumClient {\n  private readonly wagmi = {} as Client\n  public walletConnectUri = ''\n  public walletConnectVersion = 1\n  public readonly chains = [] as Chain[]\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  public constructor(wagmi: any, chains: Chain[]) {\n    const walletConnect = wagmi.connectors.find((c: Connector) => c.id === 'walletConnect')\n    if (!walletConnect) {\n      throw new Error('WalletConnectConnector is required')\n    }\n    this.wagmi = wagmi\n    this.chains = chains\n    this.walletConnectVersion = Number(walletConnect.options.version ?? '1')\n  }\n\n  // -- private ------------------------------------------- //\n  private getDefaultConnectorChainId(connector: Connector) {\n    return connector.chains[0].id\n  }\n\n  private async connectWalletConnectV1(connector: Connector, onUri: (uri: string) => void) {\n    return new Promise<void>((resolve, reject) => {\n      connector.once('message', async ({ type }) => {\n        if (type === 'connecting') {\n          const providerConnector = (await connector.getProvider()).connector\n          this.walletConnectUri = providerConnector.uri\n          onUri(providerConnector.uri)\n          providerConnector.on('disconnect', () => {\n            reject(Error())\n          })\n          providerConnector.on('connect', () => {\n            resolve()\n          })\n        }\n      })\n    })\n  }\n\n  private async connectWalletConnectV2(connector: Connector, onUri: (uri: string) => void) {\n    return new Promise<void>(resolve => {\n      connector.on('message', ({ type, data }) => {\n        if (type === 'display_uri') {\n          this.walletConnectUri = data as string\n          onUri(data as string)\n        }\n        if (type === 'connecting') {\n          resolve()\n        }\n      })\n    })\n  }\n\n  // -- public web3modal ---------------------------------- //\n  public namespace = 'eip155'\n\n  public getDefaultChain() {\n    const mainnet = this.chains.find(chain => chain.id === 1)\n\n    return mainnet ?? this.chains[0]\n  }\n\n  public getConnectorById(id: ConnectorId | string) {\n    const connector = this.wagmi.connectors.find(item => item.id === id)\n    if (!connector) {\n      throw new Error(`Connector for id ${id} was not found`)\n    }\n\n    return connector\n  }\n\n  public getConnectors() {\n    const connectors = this.wagmi.connectors.filter(connector => connector.id !== 'walletConnect')\n\n    return connectors\n  }\n\n  public async connectWalletConnect(onUri: (uri: string) => void, selectedChainId?: number) {\n    const connector = this.getConnectorById('walletConnect')\n    const isV1 = this.walletConnectVersion === 1\n    const chainId = selectedChainId ?? this.getDefaultConnectorChainId(connector)\n    const handleProviderEvents = isV1\n      ? this.connectWalletConnectV1.bind(this)\n      : this.connectWalletConnectV2.bind(this)\n    const [data] = await Promise.all([\n      connect({ connector, chainId }),\n      handleProviderEvents(connector, onUri)\n    ])\n\n    return data\n  }\n\n  public async connectConnector(connectorId: ConnectorId | string, selectedChainId?: number) {\n    const connector = this.getConnectorById(connectorId)\n    const chainId = selectedChainId ?? this.getDefaultConnectorChainId(connector)\n    const data = await connect({ connector, chainId })\n\n    return data\n  }\n\n  public disconnect = disconnect\n\n  public getAccount = getAccount\n\n  public watchAccount = watchAccount\n\n  public fetchBalance = fetchBalance\n\n  public getNetwork = getNetwork\n\n  public watchNetwork = watchNetwork\n\n  public switchNetwork = switchNetwork\n\n  // -- public web3modal (optional) ----------------------- //\n  public fecthEnsName = fetchEnsName\n\n  public fetchEnsAvatar = fetchEnsAvatar\n}\n","import { InjectedConnector } from '@wagmi/core'\nimport { CoinbaseWalletConnector } from '@wagmi/core/connectors/coinbaseWallet'\nimport { WalletConnectConnector } from '@wagmi/core/connectors/walletConnect'\nimport { jsonRpcProvider } from '@wagmi/core/providers/jsonRpc'\nimport type { ModalConnectorsOpts, WalletConnectProviderOpts } from './types'\n\n// -- constants ------------------------------------------------------- //\nexport const NAMESPACE = 'eip155'\n\n// -- providers ------------------------------------------------------- //\nexport function walletConnectProvider({ projectId }: WalletConnectProviderOpts) {\n  return jsonRpcProvider({\n    rpc: chain => {\n      const supportedChains = [\n        1, 3, 4, 5, 10, 42, 56, 69, 97, 100, 137, 420, 42161, 42220, 43114, 80001, 421611, 421613,\n        1313161554, 11297108109\n      ]\n\n      if (supportedChains.includes(chain.id)) {\n        return {\n          http: `https://rpc.walletconnect.com/v1/?chainId=${NAMESPACE}:${chain.id}&projectId=${projectId}`\n        }\n      }\n\n      return {\n        http: chain.rpcUrls.default.http[0],\n        webSocket: chain.rpcUrls.default.webSocket?.[0]\n      }\n    }\n  })\n}\n\n// -- connectors ------------------------------------------------------ //\nexport function modalConnectors({ appName, chains, version, projectId }: ModalConnectorsOpts) {\n  if (version === '2' && !projectId) {\n    throw new Error('modalConnectors() requires projectId for WalletConnect version 2')\n  }\n\n  return [\n    // @ts-expect-error - projectId is checked above\n    new WalletConnectConnector({ chains, options: { qrcode: false, version, projectId } }),\n    new InjectedConnector({\n      chains,\n      options: { shimDisconnect: true, shimChainChangedDisconnect: true }\n    }),\n    new CoinbaseWalletConnector({ chains, options: { appName } })\n  ]\n}\n"],"names":["EthereumClient","wagmi","chains","disconnect","getAccount","watchAccount","fetchBalance","getNetwork","watchNetwork","switchNetwork","fetchEnsName","fetchEnsAvatar","_a","walletConnect","c","connector","onUri","resolve","reject","type","providerConnector","data","mainnet","chain","id","item","selectedChainId","isV1","chainId","handleProviderEvents","connect","connectorId","NAMESPACE","walletConnectProvider","projectId","jsonRpcProvider","modalConnectors","appName","version","WalletConnectConnector","InjectedConnector","CoinbaseWalletConnector"],"mappings":"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"}