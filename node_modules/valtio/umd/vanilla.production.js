!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("proxy-compare")):"function"==typeof define&&define.amd?define(["exports","proxy-compare"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).valtioVanilla={},e.proxyCompare)}(this,(function(e,t){"use strict";var r=function(e){return"object"==typeof e&&null!==e},n=new WeakMap,o=new WeakSet,i=function(e,i,c,u,s,l,v,d,p){return void 0===e&&(e=Object.is),void 0===i&&(i=function(e,t){return new Proxy(e,t)}),void 0===c&&(c=function(e){return r(e)&&!o.has(e)&&(Array.isArray(e)||!(Symbol.iterator in e))&&!(e instanceof WeakMap)&&!(e instanceof WeakSet)&&!(e instanceof Error)&&!(e instanceof Number)&&!(e instanceof Date)&&!(e instanceof String)&&!(e instanceof RegExp)&&!(e instanceof ArrayBuffer)}),void 0===u&&(u=function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:throw e}}),void 0===s&&(s=new WeakMap),void 0===l&&(l=function(e,r,i){void 0===i&&(i=u);var c=s.get(e);if((null==c?void 0:c[0])===r)return c[1];var a=Array.isArray(e)?[]:Object.create(Object.getPrototypeOf(e));return t.markToTrack(a,!0),s.set(e,[r,a]),Reflect.ownKeys(e).forEach((function(r){var c=Reflect.get(e,r);o.has(c)?(t.markToTrack(c,!1),a[r]=c):c instanceof Promise?Object.defineProperty(a,r,{get:function(){return i(c)}}):n.has(c)?a[r]=f(c,i):a[r]=c})),Object.freeze(a)}),void 0===v&&(v=new WeakMap),void 0===d&&(d=[1,1]),void 0===p&&(p=function(o){if(!r(o))throw new Error("object required");var f=v.get(o);if(f)return f;var u=d[0],s=new Set,p=function(e,t){void 0===t&&(t=++d[0]),u!==t&&(u=t,s.forEach((function(r){return r(e,t)})))},y=d[1],h=function(e){return function(t,r){var n=[].concat(t);n[1]=[e].concat(n[1]),p(n,r)}},g=new Map,b=function(e){var t,r=g.get(e);r&&(g.delete(e),null==(t=r[1])||t.call(r))},j=Array.isArray(o)?[]:Object.create(Object.getPrototypeOf(o)),w=i(j,{deleteProperty:function(e,t){var r=Reflect.get(e,t);b(t);var n=Reflect.deleteProperty(e,t);return n&&p(["delete",[t],r]),n},set:function(o,i,f,u){var l,v=Reflect.has(o,i),d=Reflect.get(o,i,u);if(v&&e(d,f))return!0;b(i),r(f)&&(f=t.getUntracked(f)||f);var y=f;if(null!=(l=Object.getOwnPropertyDescriptor(o,i))&&l.set);else if(f instanceof Promise)f.then((function(e){f.status="fulfilled",f.value=e,p(["resolve",[i],e])})).catch((function(e){f.status="rejected",f.reason=e,p(["reject",[i],e])}));else{!n.has(f)&&c(f)&&(y=a(f));var j=n.get(y);j&&function(e,t){if(s.size){var r=t[3](h(e));g.set(e,[t,r])}else g.set(e,[t])}(i,j)}return Reflect.set(o,i,y,u),p(["set",[i],f,d]),!0}});v.set(o,w);var O=[j,function(e){return void 0===e&&(e=++d[1]),y===e||s.size||(y=e,g.forEach((function(t){var r=t[0][1](e);r>u&&(u=r)}))),u},l,function(e){s.add(e),1===s.size&&g.forEach((function(e,t){var r=e[0];e[1];var n=r[3](h(t));g.set(t,[r,n])}));return function(){s.delete(e),0===s.size&&g.forEach((function(e,t){var r=e[0],n=e[1];n&&(n(),g.set(t,[r]))}))}}];return n.set(w,O),Reflect.ownKeys(o).forEach((function(e){var t=Object.getOwnPropertyDescriptor(o,e);t.get||t.set?Object.defineProperty(j,e,t):w[e]=o[e]})),w}),[p,n,o,e,i,c,u,s,l,v,d]},c=i()[0];function a(e){return void 0===e&&(e={}),c(e)}function f(e,t){var r=n.get(e),o=r[0],i=r[1];return(0,r[2])(o,i(),t)}var u=i;e.getVersion=function(e){var t=n.get(e);return null==t?void 0:t[1]()},e.proxy=a,e.ref=function(e){return o.add(e),e},e.snapshot=f,e.subscribe=function(e,t,r){var o,i=n.get(e),c=[],a=i[3],f=!1,u=a((function(e){c.push(e),r?t(c.splice(0)):o||(o=Promise.resolve().then((function(){o=void 0,f&&t(c.splice(0))})))}));return f=!0,function(){f=!1,u()}},e.unstable_buildProxyFunction=u}));
